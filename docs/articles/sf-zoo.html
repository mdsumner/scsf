<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Simple features and the spatial zoo • scsf</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">scsf</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Simple features and the spatial zoo</h1>
                        <h4 class="author">Michael D. Sumner</h4>
            
            <h4 class="date">2017-02-28</h4>
          </div>

    
    
<div class="contents">
<div id="base-graphics" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#base-graphics" class="anchor"> </a></body></html>Base graphics</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p1 &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.75</span>, <span class="dv">1</span>,   <span class="fl">0.5</span>, <span class="fl">0.8</span>, <span class="fl">0.69</span>, <span class="dv">0</span>), 
           <span class="dt">y =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>,    <span class="fl">0.8</span>, <span class="fl">0.7</span>, <span class="fl">0.6</span>, <span class="dv">0</span>,    <span class="dv">0</span>))
p2 &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.2</span>), 
            <span class="dt">y =</span> <span class="kw">c</span>(<span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.4</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span>))
p4 &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="fl">0.69</span>, <span class="fl">0.8</span>, <span class="fl">1.1</span>, <span class="fl">1.23</span>, <span class="fl">0.69</span>), 
            <span class="dt">y =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.6</span>, <span class="fl">0.63</span>, <span class="fl">0.3</span>, <span class="dv">0</span>))
pp &lt;-<span class="st"> </span><span class="kw">rbind</span>(p1, <span class="ot">NA</span>,  p2[<span class="kw">nrow</span>(p2):<span class="dv">1</span>, ])
<span class="kw">plot</span>(<span class="kw">rbind</span>(pp, p4), <span class="dt">cex =</span> <span class="fl">1.3</span>, <span class="dt">main =</span> <span class="st">"two polygons, shared edge"</span>)
<span class="kw">polypath</span>(pp, <span class="dt">col =</span> <span class="st">"grey"</span>)
<span class="kw">polypath</span>(p4, <span class="dt">col =</span> <span class="st">"firebrick"</span>)</code></pre></div>
<p><img src="sf-zoo_files/figure-html/unnamed-chunk-1-1.png" width="672"></p>
</div>
<div id="simple-features-for-r" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#simple-features-for-r" class="anchor"> </a></body></html>Simple features for R</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#devtools::install_github("edzer/sfr")</span>
<span class="kw">library</span>(sf)
<span class="kw">library</span>(tibble)
x &lt;-<span class="st"> </span><span class="kw">st_as_sf</span>(<span class="kw">tibble</span>(<span class="dt">a =</span> <span class="dv">1</span>:<span class="dv">2</span>, <span class="dt">geom =</span> <span class="kw">st_sfc</span>(<span class="kw">list</span>(<span class="kw">st_multipolygon</span>(<span class="kw">list</span>(<span class="kw">list</span>(p1, p2[<span class="kw">rev</span>(<span class="kw">seq</span>(<span class="kw">nrow</span>(p2))), ]))),  
                                                 <span class="kw">st_multipolygon</span>(<span class="kw">list</span>(<span class="kw">list</span>(p4)))))))
<span class="kw">plot</span>(<span class="kw">st_geometry</span>(x), <span class="dt">col =</span> <span class="kw">c</span>(<span class="st">"grey"</span>, <span class="st">"firebrick"</span>))</code></pre></div>
<p><img src="sf-zoo_files/figure-html/unnamed-chunk-2-1.png" width="672"></p>
</div>
<div id="spatial-legacy-sp-package" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#spatial-legacy-sp-package" class="anchor"> </a></body></html>Spatial (legacy sp package)</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(sp)
spgdf &lt;-<span class="st"> </span><span class="kw">as</span>(x, <span class="st">"Spatial"</span>)
<span class="kw">plot</span>(spgdf, <span class="dt">col =</span> <span class="kw">c</span>(<span class="st">"grey"</span>, <span class="st">"firebrick"</span>))</code></pre></div>
<p><img src="sf-zoo_files/figure-html/unnamed-chunk-3-1.png" width="672"></p>
</div>
<div id="grammar-of-graphics" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#grammar-of-graphics" class="anchor"> </a></body></html>Grammar of graphics</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## fortify model
<span class="kw">library</span>(dplyr)
meta &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(x %&gt;%<span class="st"> </span>dplyr::<span class="kw">select</span>(-geom) %&gt;%<span class="st"> </span><span class="kw">mutate</span>(<span class="dt">object_ =</span> <span class="kw">row_number</span>()))
map &lt;-<span class="st"> </span><span class="kw">PATH</span>(<span class="kw">st_as_sf</span>(spgdf))
<span class="kw">library</span>(ggplot2)
ggcols &lt;-<span class="st"> </span>ggplot2::<span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">"1"</span> =<span class="st"> "grey"</span>, <span class="st">"2"</span>  =<span class="st"> "firebrick"</span>)) 
<span class="kw">ggplot</span>(map %&gt;%<span class="st"> </span><span class="kw">mutate</span>(<span class="dt">rn =</span> <span class="kw">row_number</span>()) %&gt;%<span class="st"> </span><span class="kw">inner_join</span>(meta)) +<span class="st"> </span><span class="kw">aes</span>(<span class="dt">x =</span> x_, <span class="dt">y =</span> y_, <span class="dt">group =</span> path_, <span class="dt">fill =</span> <span class="kw">factor</span>(object_)) +
<span class="st">  </span>ggcols +<span class="st"> </span>ggpolypath::<span class="kw">geom_polypath</span>() +<span class="st"> </span><span class="kw">geom_path</span>()</code></pre></div>
</div>
<div id="map-table" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#map-table" class="anchor"> </a></body></html>Map table</h2>
<p>This is a four-table decomposition of Spatial objects, a normalization of the fortify model.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(spbabel)
mp &lt;-<span class="st"> </span><span class="kw">map_table</span>(spgdf)
ggcols &lt;-<span class="st"> </span>ggplot2::<span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> <span class="kw">setNames</span>(<span class="kw">c</span>(<span class="st">"grey"</span>, <span class="st">"firebrick"</span>), mp$object$object_))
gg &lt;-<span class="st"> </span><span class="kw">ggplot</span>(mp$object %&gt;%<span class="st"> </span><span class="kw">inner_join</span>(mp$path) %&gt;%<span class="st"> </span><span class="kw">inner_join</span>(mp$path_link_vertex) %&gt;%<span class="st"> </span><span class="kw">inner_join</span>(mp$vertex))
gg +<span class="st"> </span><span class="kw">aes</span>(<span class="dt">x =</span> x_, <span class="dt">y =</span> y_, <span class="dt">group =</span> path_, <span class="dt">fill =</span> object_) +<span class="st"> </span>ggcols +<span class="st"> </span>ggpolypath::<span class="kw">geom_polypath</span>() +<span class="st"> </span><span class="kw">geom_path</span>(<span class="dt">lwd =</span> <span class="dv">2</span>)</code></pre></div>
</div>
<div id="planar-straight-line-graph" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#planar-straight-line-graph" class="anchor"> </a></body></html>Planar straight line graph</h2>
<p>Here we identify all <strong>edges</strong>, i.e. line segments between a pair of coordinates, regardless of direction.</p>
<p>Note in the second plot we identify “nodes”, and that there are two segments that overlap between the neighbouring polygons. In Arc speak this is just one arc, but in simple features it is just a segment on one polygon path, and another segment on the other polygon path, without any explicit record or knowledge of that relationship.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p2seg &lt;-<span class="st"> </span>function(x) <span class="kw">as_tibble</span>(rangl:::<span class="kw">path2seg</span>(x$vertex_))
BxE &lt;-<span class="st"> </span>mp$path_link_vertex %&gt;%<span class="st"> </span><span class="kw">split</span>(.$path_) %&gt;%<span class="st"> </span>purrr::<span class="kw">map</span>(p2seg) %&gt;%<span class="st"> </span><span class="kw">bind_rows</span>(<span class="dt">.id =</span> <span class="st">"path_"</span>) 
<span class="kw">ggplot</span>(BxE %&gt;%<span class="st"> </span><span class="kw">inner_join</span>(mp$v %&gt;%<span class="st"> </span><span class="kw">rename</span>(<span class="dt">x =</span> x_, <span class="dt">y =</span> y_), <span class="kw">c</span>(<span class="st">"V1"</span> =<span class="st"> "vertex_"</span>)) %&gt;%<span class="st"> </span>
<span class="st">                            </span><span class="kw">inner_join</span>(mp$v, <span class="kw">c</span>(<span class="st">"V2"</span> =<span class="st"> "vertex_"</span>))) +<span class="st"> </span>
<span class="st">  </span><span class="kw">geom_segment</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">xend =</span> x_, <span class="dt">yend =</span> y_, <span class="dt">colour =</span> V1)) <span class="co">#+ guides(colour = FALSE)</span>


uE &lt;-<span class="st"> </span>mp$path_link_vertex %&gt;%<span class="st"> </span><span class="kw">split</span>(.$path_) %&gt;%<span class="st"> </span>purrr::<span class="kw">map</span>(p2seg) %&gt;%<span class="st"> </span><span class="kw">bind_rows</span>(<span class="dt">.id =</span> <span class="st">"path_"</span>)%&gt;%<span class="st"> </span><span class="kw">mutate</span>(<span class="dt">edge_ =</span> <span class="kw">row_number</span>()) %&gt;%<span class="st"> </span>
<span class="st">   </span><span class="kw">mutate</span>(<span class="dt">uu =</span> <span class="kw">paste</span>(<span class="kw">pmin</span>(V1, V2), <span class="kw">pmax</span>(V1, V2), <span class="dt">sep =</span> <span class="st">"_"</span>)) %&gt;%<span class="st"> </span><span class="kw">distinct</span>(uu, <span class="dt">.keep_all =</span> <span class="ot">TRUE</span>)
nodes &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(mp$v %&gt;%<span class="st"> </span>dplyr::<span class="kw">select</span>(vertex_) %&gt;%<span class="st"> </span><span class="kw">inner_join</span>(uE, <span class="kw">c</span>(<span class="st">"vertex_"</span> =<span class="st"> "V1"</span>)), 
          mp$v %&gt;%<span class="st"> </span>dplyr::<span class="kw">select</span>(vertex_) %&gt;%<span class="st"> </span><span class="kw">inner_join</span>(uE, <span class="kw">c</span>(<span class="st">"vertex_"</span> =<span class="st"> "V2"</span>))) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">distinct</span>(edge_, vertex_) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(vertex_) %&gt;%<span class="st"> </span><span class="kw">mutate</span>(<span class="dt">nb =</span> <span class="kw">n</span>()) %&gt;%<span class="st"> </span><span class="kw">ungroup</span>() %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(nb &gt;<span class="st"> </span><span class="dv">2</span>) %&gt;%<span class="st"> </span><span class="kw">distinct</span>(vertex_) %&gt;%<span class="st"> </span><span class="kw">inner_join</span>(mp$v)


<span class="kw">plot</span>(spgdf)
<span class="kw">points</span>(nodes$x_, nodes$y_, <span class="dt">cex =</span> <span class="fl">0.9</span>)</code></pre></div>
</div>
<div id="arc-node" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#arc-node" class="anchor"> </a></body></html>Arc-node</h2>
<p>NOT YET IMPLEMENTED</p>
<p>What is arc-node? The nodes in the graph are the vertices that are shared by any two arcs. The arcs are the <em>paths</em> that trace a line between nodes. This means that not all coordinates are nodes, and even that not all <em>parts</em> have any node/s at all. We can produce this by traversal of all edges to determine the arcs that join nodes and anything left is just a standalone arc. This is brute-force remove duplicate edges (ignore direction), join on start vertex, end vertex, count the number of edges involved and any with 3 edges is a <strong>Node</strong>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## what are the nodes?
x1 &lt;-<span class="st"> </span><span class="kw">st_read</span>(<span class="kw">system.file</span>(<span class="st">"shape/nc.shp"</span>, <span class="dt">package=</span><span class="st">"sf"</span>), <span class="st">"nc"</span>, <span class="dt">crs =</span> <span class="dv">4267</span>)
nodes &lt;-<span class="st"> </span><span class="kw">arc_node</span>(x1)  ## NARC?

<span class="kw">plot</span>(<span class="kw">st_geometry</span>(x1))
<span class="kw">points</span>(nodes$x_, nodes$y_, <span class="dt">cex =</span> <span class="fl">0.9</span>)</code></pre></div>
<p>Arc-node topology was used by the Arc Info software prior to the invention of the shapefile and ArcView . . .</p>
<p>TopoJSON uses this model, or at least something very similar to it: <a href="https://github.com/topojson/topojson/wiki" class="uri">https://github.com/topojson/topojson/wiki</a></p>
</div>
<div id="simplicial-complex" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#simplicial-complex" class="anchor"> </a></body></html>Simplicial complex</h2>
<p>The simplicial complex is more abstract than arc-node topology, but also much more general. Arcs can only be joined to bound regions in the plane, but the simplicial complex is composed of <strong>primitives</strong> for any topology. Coordinates are 0-D primitives, line segments are 1-D primitives, and triangles are 2-primitives. We are free to store any chosen geometry on the coordinates of primitives, so they can describe overlapping surfaces in 3D space, or connected paths through 4D space. There’s a natual extension up in dimension to volumes as well, where 3-D primitives (tetrahedron) compose 3D-space filling shapes, and so on.</p>
<p>In short, arc-node is one of several <em>2D-only</em> optimizations for spatial data that do no apply to higher dimensional topologies and/or higher dimensional geometry. The simplicial complex is a finite-element model that is general enough for any spatial or other hierarchically organized multi-dimensional data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sc &lt;-<span class="st"> </span>rangl::<span class="kw">rangl</span>(spgdf)

<span class="kw">plot</span>(sc)

<span class="kw">plot</span>(x)
l1 &lt;-<span class="st"> </span><span class="kw">inner_join</span>(sc$o[<span class="dv">1</span>, ], sc$t) %&gt;%<span class="st"> </span><span class="kw">split</span>(.$triangle_) %&gt;%<span class="st"> </span>purrr::<span class="kw">map</span>(function(x) <span class="kw">inner_join</span>(x, sc$tXv) %&gt;%<span class="st"> </span><span class="kw">inner_join</span>(sc$v)) 
j &lt;-<span class="st"> </span><span class="kw">lapply</span>(l1, function(x) <span class="kw">polygon</span>(<span class="kw">cbind</span>(x$x_, x$y_), <span class="dt">col =</span> <span class="st">"grey"</span>))
l2 &lt;-<span class="st"> </span><span class="kw">inner_join</span>(sc$o[<span class="dv">2</span>, ], sc$t) %&gt;%<span class="st"> </span><span class="kw">split</span>(.$triangle_) %&gt;%<span class="st"> </span>purrr::<span class="kw">map</span>(function(x) <span class="kw">inner_join</span>(x, sc$tXv) %&gt;%<span class="st"> </span><span class="kw">inner_join</span>(sc$v)) 
j &lt;-<span class="st"> </span><span class="kw">lapply</span>(l2, function(x) <span class="kw">polygon</span>(<span class="kw">cbind</span>(x$x_, x$y_), <span class="dt">col =</span> <span class="st">"firebrick"</span>))


## this is slow but does show that we have a full and constrained triangulation
 <span class="kw">set.seed</span>(<span class="dv">75</span>)
sc &lt;-<span class="st"> </span>rangl::<span class="kw">rangl</span>(<span class="kw">as</span>(x1[<span class="dv">24</span>:<span class="dv">30</span>, ], <span class="st">"Spatial"</span>))
<span class="kw">plot</span>(x1[<span class="dv">24</span>:<span class="dv">30</span>, ], <span class="dt">border =</span> <span class="st">"black"</span>, <span class="dt">lwd =</span> <span class="dv">4</span>)
for (i in <span class="kw">seq</span>(<span class="kw">nrow</span>(x1))) {
  l1 &lt;-<span class="st"> </span><span class="kw">inner_join</span>(sc$o[i, ], sc$t, <span class="st">"object_"</span>) %&gt;%<span class="st"> </span><span class="kw">split</span>(.$triangle_) %&gt;%<span class="st"> </span>purrr::<span class="kw">map</span>(function(x) <span class="kw">inner_join</span>(x, sc$tXv, <span class="st">"triangle_"</span>) %&gt;%<span class="st"> </span><span class="kw">inner_join</span>(sc$v, <span class="st">"vertex_"</span>)) 
 
  j &lt;-<span class="st"> </span><span class="kw">lapply</span>(l1, function(x) <span class="kw">polygon</span>(<span class="kw">cbind</span>(x$x_, x$y_), <span class="dt">border =</span> <span class="kw">sample</span>(<span class="kw">c</span>(<span class="st">"grey"</span>, <span class="st">"firebrick"</span>, viridis::<span class="kw">viridis</span>(<span class="dv">5</span>)), <span class="dv">1</span>)))
}</code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#base-graphics">Base graphics</a></li>
      <li><a href="#simple-features-for-r">Simple features for R</a></li>
      <li><a href="#spatial-legacy-sp-package">Spatial (legacy sp package)</a></li>
      <li><a href="#grammar-of-graphics">Grammar of graphics</a></li>
      <li><a href="#map-table">Map table</a></li>
      <li><a href="#planar-straight-line-graph">Planar straight line graph</a></li>
      <li><a href="#arc-node">Arc-node</a></li>
      <li><a href="#simplicial-complex">Simplicial complex</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Michael D. Sumner, Simon Wotherspoon.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
